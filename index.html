<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Merry Christmas ğŸ ğŸ„</title>
  <style>
    :root{--bg:#f7f7fb;--card:#fff;--accent:#0b6efd}
    *{box-sizing:border-box;font-family:Arial, "Noto Sans Arabic", sans-serif}
    body{margin:0;background:linear-gradient(180deg,#fff 0%,#f0f7ff 100%);color:#111}
    .center{display:flex;align-items:center;justify-content:center}
    header{padding:16px;text-align:center}
    .site-title{font-size:28px;margin-bottom:8px}
    .subtitle{color:#555}
    .container{max-width:900px;margin:20px auto;padding:16px}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:18px}
    .card{background:var(--card);padding:22px;border-radius:12px;box-shadow:0 6px 18px rgba(12,20,40,.06);cursor:pointer;transition:transform .14s}
    .card:hover{transform:translateY(-6px)}
    .amount{font-size:28px;font-weight:700;margin-bottom:6px}
    .note{color:#666}
    /* overlay intro */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:40}
    .intro{background:#fff;padding:28px;border-radius:12px;max-width:420px;width:90%;text-align:center}
    .intro input{width:100%;padding:10px;margin-top:12px;border-radius:8px;border:1px solid #ddd}
    .btn{display:inline-block;padding:10px 16px;border-radius:8px;border:none;background:var(--accent);color:#fff;margin-top:12px;cursor:pointer}
    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.4);z-index:50}
    .modal.show{display:flex}
    .modal .box{background:#fff;padding:20px;border-radius:12px;max-width:420px;width:90%}
    .row{display:flex;gap:8px;align-items:center}
    .success{color:green;margin-top:10px}
    footer{padding:24px;text-align:center;color:#666}
  </style>
</head>
<body dir="rtl">
  <header>
    <div class="site-title">Merry Christmas ğŸ ğŸ„</div>
    <div class="subtitle">Ø§Ù‡Ø¯ÙŠ Ù‡Ø¯ÙŠØ© Ù„Ø§Ù‡Ù„Ùƒ â€” Ø§Ø®ØªØ± Ù…Ø¨Ù„Øº ÙˆØ­ÙˆÙ„</div>
  </header>

  <div class="container">
    <div style="margin-bottom:12px">Ù…Ø±Ø­Ø¨Ø§ <span id="visitorNameDisplay" style="font-weight:700">Ø¶ÙŠÙ</span> â€” Ø§Ø®ØªØ§Ø± Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</div>

    <div class="cards" id="cards">
      <div class="card" data-amount="100">
        <div class="amount">ØªØ­ÙˆÙŠÙ„ 100</div>
        <div class="note">Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯!</div>
      </div>
      <div class="card" data-amount="100">
        <div class="amount">ØªØ­ÙˆÙ„ÙŠ 100</div>
        <div class="note">Ù‡Ø¯ÙŠØ© Ø¨Ø³ÙŠØ·Ø©</div>
      </div>
      <div class="card" data-amount="200">
        <div class="amount">ØªØ­ÙˆÙŠÙ„ 200</div>
        <div class="note">ÙØ±Ø­Ø© Ø£ÙƒØ¨Ø±</div>
      </div>
      <div class="card" data-amount="200">
        <div class="amount">ØªØ­ÙˆÙ„ÙŠ 200</div>
        <div class="note">Ù…ÙØ§Ø¬Ø£Ø©!</div>
      </div>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="box">
      <h3 id="modalTitle">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„</h3>
      <div style="margin-top:8px">
        <div>Ø§Ù„Ù…Ø¨Ù„Øº: <strong id="modalAmount"></strong></div>
        <div style="margin-top:10px">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„ (Ø³ÙŠØ¸Ù‡Ø± Ù„Ù„Ø£Ø¯Ù…Ù†):</label>
          <input id="payerName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #ddd" />
        </div>
        <div style="margin-top:10px">
          <label>Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
          <input id="note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© Ù‚ØµÙŠØ±Ø©" style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #ddd" />
        </div>
        <div style="margin-top:14px" class="row">
          <button class="btn" id="confirmBtn">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„</button>
          <button class="btn" id="cancelBtn" style="background:#ccc;color:#111">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
        <div id="modalMsg" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <!-- intro overlay to ask name first -->
  <div class="overlay" id="overlay">
    <div class="intro">
      <h2>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <input id="visitorName" placeholder="Ø§Ø³Ù…Ùƒ" />
      <div style="margin-top:10px">
        <button class="btn" id="enterBtn">Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
      </div>
    </div>
  </div>

  <footer>
    &copy; Merry Christmas â€” Ù‡Ø¯ÙŠØ© Ù„Ø¹Ø§Ø¦Ù„ØªÙŠ
  </footer>

<script>
  // init
  const overlay = document.getElementById('overlay');
  const enterBtn = document.getElementById('enterBtn');
  const visitorNameInput = document.getElementById('visitorName');
  const visitorNameDisplay = document.getElementById('visitorNameDisplay');

  enterBtn.addEventListener('click', () => {
    const name = (visitorNameInput.value || 'Ø¶ÙŠÙ').trim();
    visitorNameDisplay.textContent = name;
    overlay.style.display = 'none';
    localStorage.setItem('visitorName', name);
  });

  // restore if present
  const savedName = localStorage.getItem('visitorName');
  if (savedName) {
    visitorNameDisplay.textContent = savedName;
    overlay.style.display = 'none';
  }

  // cards
  document.querySelectorAll('.card').forEach(card => {
    card.addEventListener('click', () => {
      const amount = card.getAttribute('data-amount');
      openModal(amount);
    });
  });

  const modal = document.getElementById('modal');
  const modalAmount = document.getElementById('modalAmount');
  const payerNameInput = document.getElementById('payerName');
  const noteInput = document.getElementById('note');
  const confirmBtn = document.getElementById('confirmBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const modalMsg = document.getElementById('modalMsg');

  function openModal(amount) {
    modal.classList.add('show');
    modalAmount.textContent = amount;
    payerNameInput.value = localStorage.getItem('visitorName') || '';
    noteInput.value = '';
    modalMsg.textContent = '';
  }
  cancelBtn.addEventListener('click', () => modal.classList.remove('show'));

  confirmBtn.addEventListener('click', async () => {
    const amount = modalAmount.textContent;
    const payerName = payerNameInput.value.trim() || 'Ø¶ÙŠÙ';
    const note = noteInput.value.trim();

    confirmBtn.disabled = true;
    confirmBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

    try {
      const resp = await fetch('/transfer', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ payerName, amount, note })
      });
      const data = await resp.json();
      if (data.ok) {
        modalMsg.innerHTML = '<span class="success">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ğŸ„</span>';
        // keep record
        localStorage.setItem('visitorName', payerName);
      } else {
        modalMsg.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£: ' + (data.message || 'unknown');
      }
    } catch (err) {
      modalMsg.textContent = 'ÙØ´Ù„ Ø§Ù„Ø¥ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….';
    } finally {
      confirmBtn.disabled = false;
      confirmBtn.textContent = 'ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„';
    }
  });
</script>
</body>
</html>
