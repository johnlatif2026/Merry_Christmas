<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard - التحويلات</title>
  <style>
    body { font-family: Arial, sans-serif; padding:20px; direction: rtl; background:#f3f4f6; color:#111827; }
    h1 { margin-bottom:10px; }
    table { width:100%; border-collapse: collapse; background:#fff; border-radius:8px; overflow:hidden; }
    th, td { padding:12px; border-bottom:1px solid #e5e7eb; text-align:right; }
    th { background:#111827; color:#fff; text-align:right; }
    .controls { margin-bottom:12px; }
    .pw { padding:8px; border-radius:6px; border:1px solid #d1d5db; width:260px; }
    .btn { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; background:#2563eb; color:#fff; }
  </style>
</head>
<body>
  <h1>لوحة تحكم التحويلات</h1>
  <div class="controls">
    <input id="pw" class="pw" type="password" placeholder="ادخل كلمة سر الادمن">
    <button id="load" class="btn">تحميل التحويلات</button>
  </div>

  <div id="tableWrap"></div>

<script>
document.getElementById('load').addEventListener('click', async () => {
  const pw = document.getElementById('pw').value;
  if (!pw) return alert('ادخل كلمة السر');
  try {
    const res = await fetch('/api/transfers?pw=' + encodeURIComponent(pw));
    const body = await res.json();
    if (!body.ok) return alert('خطأ: ' + (body.message || 'unauthorized'));
    const transfers = body.transfers || [];
    if (!transfers.length) {
      document.getElementById('tableWrap').innerHTML = '<p>لا توجد تحويلات حتى الآن.</p>';
      return;
    }
    let html = '<table><thead><tr><th>الوقت</th><th>الاسم</th><th>المبلغ</th><th>ملاحظة</th></tr></thead><tbody>';
    transfers.slice().reverse().forEach(t => {
      html += `<tr><td>${t.timestamp}</td><td>${t.name}</td><td>${t.amount}</td><td>${t.note || '-'}</td></tr>`;
    });
    html += '</tbody></table>';
    document.getElementById('tableWrap').innerHTML = html;
  } catch (err) {
    alert('فشل تحميل التحويلات');
    console.error(err);
  }
});
</script>
</body>
</html>
